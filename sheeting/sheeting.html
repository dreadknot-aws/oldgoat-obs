<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Sheeting</title>
    <style>
        body {
            margin: 0;
            background-color: rgba(0, 0, 0, 0);
            overflow: hidden;
        }

        canvas {
            width: 1280px;
            height: 720px;
            background-color: rgba(0, 0, 0, 0);
            margin: 0;
        }
    </style>
</head>

<body>
    <!-- <img src="ring wide center clear.png"> -->
    <canvas id="canvas" width="1280" height="720">City.html load some sheets and generate somerandom to use as input to
        the draw context.</canvas>
    <div><input type="button" value="save" id="savecanvas"></div>

</body>

<script type="module">
    import { GUI } from '../js/dat.gui.module.js';

    document.getElementById("savecanvas").addEventListener("click", savecanvas);
    function savecanvas() {
        console.log("Save")
        var canvas = document.getElementById('canvas');

        canvas.toBlob(function (blob) {
            var newImg = document.createElement('img'),
                url = URL.createObjectURL(blob);

            newImg.onload = function () {
                // no longer need to read the blob so it's revoked
                URL.revokeObjectURL(url);
            };

            newImg.src = url;
            document.body.appendChild(newImg);
        });
    }

    class Vector {
        constructor(x, y) {
            this.x = x;
            this.y = y;
        }
        add(vector) {
            this.x = this.x + vector.x;
            this.y = this.y + vector.y;
        }
        sub(vector) {
            this.x = this.x - vector.x;
            this.y = this.y - vector.y;
        }
        mult(n) {
            this.x = this.x * n;
            this.y = this.y * n;
        }
        div(n) {
            this.x = this.x / n;
            this.y = this.y / n;
        }
        mag() {
            return Math.sqrt(this.x * this.x + this.y * this.y);
        }
        normalize() {
            let m = this.mag()
            if (m != 0) {
                this.div(m);
            }
        }
        limit(max) {
            if (this.mag() > max) {
                this.normalize();
                this.mult(max);
            }

        }
    }

    class Sheeting {
        constructor() {
            this.paths = ['path1449'];
            this.comps = ['source-over',
                'lighter', 'copy', 'xor', 'multiply', 'screen', 'overlay', 'darken',
                'lighten', 'color-dodge', 'color-burn', 'hard-light', 'soft-light', 'difference', 'exclusion',
                'hue', 'saturation', 'color', 'luminosity'];
            this.width = 640
            this.height = 960
            this.sheets = 16
            this.sheetSpriteMap = new Image();
            this.sheetSpriteMap.src = this.paths[0] + '.png'
        }
        update() {
            this.velocity.add(this.acceleration)
            this.velocity.limit(.05)
            this.location.add(this.velocity)
        }
        draw(ctx) {
            // ctx.save()
            // ctx.globalCompositeOperation = comps[spin.Composite]
            // ctx.globalCompositeOperation = 'hue'
            // ctx.filter = `hue-rotate(${hue[1]}deg) brightness(${brightness[1]}%) saturate(${saturate[1]}%) invert(${invert[1]}%)`
            // ctx.filter = `hue-rotate(${hue[0]}deg) brightness(${brightness[0]}%) saturate(${saturate[0]}%) opacity(100%)`

            // ctx.fillStyle = "black";
            ctx.drawImage(img[4], this.sx, this.sy, this.sw, this.sh, this.location.x, this.location.y, this.sw * 2, this.sh * 2)
            // ctx.fillRect(this.location.x, this.location.y, this.size, this.size);
            // ctx.restore()
        }
        checkEdges() {
            if (this.location.x > 1280) {
                this.location.x = 1279
            } else if (this.location.x < 590) {
                this.location.x = 1279
            }

            if (this.location.y > this.height) {
                this.velocity.y = -this.velocity.y;
            } else if (this.location.y < this.height) {
                this.velocity.y = -this.velocity.y;
            }
        }

    }

        let aSheet = new Sheeting();


    function init() {

        window.requestAnimationFrame(draw);
    }

    function draw() {
        aSheet.draw()

        window.requestAnimationFrame(draw);
    }



    init();


</script>

</html>