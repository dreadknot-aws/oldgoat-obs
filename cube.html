<html>

<head>
	<title>My first three.js app</title>
	<style>
		body {
			margin: 0;
		}

		canvas {
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0);
		}

		#info {
			position: absolute;
			top: 10px;
			width: 100%;
			text-align: center;
			z-index: 100;
			display: block;
		}
	</style>
</head>

<body>
	<script type="module">
		import * as THREE from './js/three.module.js';
		import { GUI } from './js/dat.gui.module.js';

		var camera, scene, renderer, solarSystem;
		var mesh, cmesh;
		var bg_texture;
		var bg_city_texture;
		var materials;
		var city_img = new Array(4);
		var comps = ['destination-over', 'source-over', 'source-in',
			'source-out', 'source-atop', 'destination-over', 'destination-in', 'destination-out',
			'destination-atop', 'lighter', 'copy', 'xor', 'multiply', 'screen', 'overlay', 'darken',
			'lighten', 'color-dodge', 'color-burn', 'hard-light', 'soft-light', 'difference', 'exclusion',
			'hue', 'saturation', 'color', 'luminosity']
		//2000 x 1333
		var city = new Image();
		var cityy = 0;
		var cityv = .1;
		var img = new Array(4);
		// var blur = new Array(4);
		var hue = new Array(4);
		var saturate = new Array(4)
		var brightness = new Array(4)
		var opacity = new Array(4)
		var invert = new Array(4)
		var angle1 = Math.random() * Math.PI * 2;
		var angle2 = Math.random() * Math.PI * 2;
		var radius = 1000;
		var x0 = Math.floor(Math.random() * 256)
		var y0 = Math.floor(Math.random() * 128)
		var x1 = Math.floor(Math.random() * 256)
		var y1 = Math.floor(Math.random() * 128)
		var r0 = Math.floor(Math.random() * 1000)
		var r1 = Math.floor(Math.random() * 1000)


		let params = (new URL(document.location)).searchParams;
		let bg_color = params.get('color'); // is the string "Jonathan Smith".
		let og_bg_color = params.get('ogcolor')
		var paths = ['path1431', 'path1433', 'path1435', 'path1437', 'path1439']
		var SpinSpeed = function () {
			this.roty = Math.random() / 100;
			this.rotx = Math.random() / 100;
			this.color0 = "#ffae23";
			this.color1 = "#021984";
			this.color2 = "#179d7d";
			this.color3 = "#97cd34";
			this.color4 = "#b0c54f";
			this.color5 = "#e64659";

			this.blur = new Array(4);

			this.blur1 = blur[1]
			this.CompositeOperation = 'hard-light'

			this.displayOutline = false;
		};

		let rotx = Math.random() / 100
		let roty = Math.random() / 100
		const gui = new GUI();
		var spin = new SpinSpeed();
		gui.add(spin, 'roty', -.100, .100);
		gui.add(spin, 'rotx', -.100, .100);
		gui.addColor(spin, 'color0');
		gui.addColor(spin, 'color1');
		gui.addColor(spin, 'color2');
		gui.addColor(spin, 'color3');
		gui.addColor(spin, 'color4');
		gui.addColor(spin, 'color5');

		function cpu_texture() {
			const ctx = document.createElement('canvas').getContext('2d');
			// document.body.appendChild(ctx.canvas);
			ctx.canvas.width = 512;
			ctx.canvas.height = 512;
			// ctx.fillStyle = '#ffffff';
			//ffae23
			ctx.fillStyle = '#' + bg_color;
			ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
			var img = new Image();   // Create new img element
			img.addEventListener('load', function () {
				ctx.drawImage(img, 0, 0, 512, 512);
			}, false);
			img.src = 'cpu.png'; // Set source path
			// var bg_texture = 
			bg_texture = new THREE.CanvasTexture(ctx.canvas);
		}

		function city_texture() {
			const ctx = document.createElement('canvas').getContext('2d');


			for (var i = 0; i <= 4; i++) {
				city_img[i] = new Image();
				city_img[i].src = paths[i] + '.png';

				hue[i] = Math.floor(Math.random() * 180)
				brightness[i] = Math.floor(Math.random() * 100)
				saturate[i] = Math.floor(Math.random() * 200)
				opacity[i] = Math.floor(Math.random() * 100)
				invert[i] = Math.floor(Math.random() * 100)
			}

			ctx.globalCompositeOperation = spin.CompositeOperation

			ctx.canvas.width = 256;
			ctx.canvas.height = 128;
			ctx.fillStyle = '#' + bg_color;
			// ctx.globalCompositeOperation = 'destination-over';
			ctx.clearRect(0, 0, 256, 128); // clear canvas
			// ctx.fillStyle = 'rgba(0, 0, 0, 255)';
			// ctx.fillStyle = `rgba(${spin.color2[0]}, ${spin.color2[1]}, ${spin.color2[2]}, 255 )`;
			// var x1 = Math.cos(angle1) * radius;
			// var y1 = Math.sin(angle1) * radius;
			// var x2 = Math.cos(angle2) * radius;
			// var y2 = Math.sin(angle2) * radius;
			var gradient = ctx.createLinearGradient(0, 0, 256, 128);
			// var gradient = ctx.createLinearGradient(x0, y0, x1, y1);
			// var gradient = ctx.createLinearGradient(x1 + 1000, y1 + 1000, x2 + 1000, y2 + 1000);
			// var gradient = ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);

			gradient.addColorStop(0, `rgba(${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, 255)`);
			gradient.addColorStop(.50, 'rgba(200, 170, 118, 255)');
			gradient.addColorStop(1, 'rgba(201, 36, 63, 255)');			
			// gradient.addColorStop(0, `rgba(${spin.color2[0]}, ${spin.color2[1]}, ${spin.color2[2]}, 255 )`);
			// gradient.addColorStop(.5, `rgba(${spin.color3[0]}, ${spin.color3[1]}, ${spin.color3[2]}, 255 )`);
			// gradient.addColorStop(1, `rgba(${spin.color2[0]}, ${spin.color2[1]}, ${spin.color2[2]}, 255 )`);
			ctx.fillStyle = gradient;

			// ctx.fillStyle = 'rgba(42, 100, 65, 255 )';
			// ctx.fillStyle = 'blue'
			// ctx.filter = 'blur(4px)';
			// ctx.filter = 'hue-rotate(180deg)';
			// ctx.filter = 'contrast(50%)'
			// ctx.filter = 'saturate(50%)'
			var time = new Date();
			// ctx.rotate(((2 * Math.PI) / 60) * time.getSeconds() + ((2 * Math.PI) / 60000) * time.getMilliseconds());
			ctx.fillRect(0, 0, 256, 128);
			// ctx.translate(150, 150);
			ctx.restore();
			// Earth

			cityy += cityv
			if (cityy >= 720)
				cityv = -cityv
			if (cityy <= 0)
				cityv = - cityv



			// ctx.rotate(((2 * Math.PI) / 60) * time.getSeconds() + ((2 * Math.PI) / 60000) * time.getMilliseconds());
			// ctx.translate(105, 0);
			// ctx.fillRect(0, -12, 40, 24); // Shadow
			// ctx.drawImage(city, 0, 500, 1280, 720, 0, 0, 1280, 720);
			// ctx.drawImage(city, cityy, 600, 1280, 720, 0, 360, 1280, 720);
			ctx.save();
			for (var i = 4; i > 0; i--) {

				// ctx.filter = 'hue-rotate(' + 56 + 'deg)';
				// ctx.filter = 'blur(' + Math.floor(Math.random() * 4) + 'px)';
				// ctx.filter = 'blur(' + blur[i] + 'px)' + hue-rotate(' + hue[i] + 'deg);
				// ctx.filter = 'blur(4px)';
				// ctx.filter = 'hue-rotate(' + hue[i] + 'deg)';
				// ctx.filter = 'brightness(' + brightness[i] + ')';
				// ctx.filter = 'saturate[i];
				// ctx.filter = '`blur(${blur[i]}px)`'
				// console.log(`blur(${blur[i]}px) hue-rotate(${hue[i]})deg`);
				// ctx.filter = `blur(${blur[i]}px) hue-rotate(${hue[i]}deg) brightness(${brightness[i]}%) saturate(${saturate[i]}%) opacity(${opacity[i]}%) invert(${invert[i]}%)`
				// ctx.drawImage(city_img[i], 0, 0, 256, 128)
				// city_img[i].addEventListener('load', function () {
				// 	ctx.drawImage(city_img[i], 0, 0, 256, 128)
				// }, false);
								// ctx.filter = 'invert(100%)';
			}
			// ctx.restore();
			//  ctx.filter = 'invert(100%)
			// ctx.drawImage(city_img[1], 0, 0, 256, 128)
			 
			city_img[2].addEventListener('load', function () {
				ctx.filter = 'brightness(10%)'
				ctx.drawImage(city_img[2], 0, 0, 256, 128)
			}, false);
			// city_img[2].addEventListener('load', function () {
			// 	ctx.drawImage(city_img[2], 0, 0, 256, 128)
			// }, false);
			// var brightness = new Array('100', '100', )
			bg_city_texture = new THREE.CanvasTexture(ctx.canvas);

		}

		const ctx_id = document.createElement('canvas').getContext('2d');
		// document.body.appendChild(ctx.canvas);
		ctx_id.canvas.width = 512;
		ctx_id.canvas.height = 512;
		ctx_id.fillStyle = '#' + og_bg_color //'#000000';
		ctx_id.fillRect(0, 0, ctx_id.canvas.width, ctx_id.canvas.height);
		var img_id = new Image();   // Create new img element
		img_id.addEventListener('load', function () {
			ctx_id.drawImage(img_id, 0, 0, 512, 512);
		}, false);
		img_id.src = 'stationid.png'; // Set source path

		const bg_texture_id = new THREE.CanvasTexture(ctx_id.canvas);

		init();
		animate();
		function init() {
			camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000);
			camera.position.z = 400;
			scene = new THREE.Scene();
			const loader = new THREE.TextureLoader();
			// var bg_texture;

			city.src = './city.jpg';
			// var texture = new THREE.TextureLoader().load('stationid.png');
			// var cputexture = new THREE.TextureLoader().load('cpu.jpg');
			var geometry = new THREE.BoxBufferGeometry(200, 200, 200);
			var sphere = new THREE.SphereBufferGeometry(125, 32, 32);

			const solarSystem = new THREE.Object3D();
			scene.add(solarSystem);
			// var loader = new THREE.CubeTextureLoader();
			// loader.setPath('./');

			// var textureCube = loader.load([
			// 	'px.jpg', 'nx.jpg',
			// 	'py.jpg', 'ny.jpg',
			// 	'pz.jpg', 'nz.jpg'
			// ]);

			// var material = new THREE.MeshBasicMaterial({ color: 0xffffff, envMap: textureCube });

			cpu_texture();
			city_texture();
			materials = [
				new THREE.MeshPhongMaterial({
					// map: loader.load('stationid.png'),
					map: bg_texture_id,
					emissiveMap: bg_texture_id, emissive: new THREE.Color('red'),
					bumpMap: bg_texture_id
				}),
				new THREE.MeshPhongMaterial({ map: bg_texture, emissiveMap: bg_texture, emissive: new THREE.Color('red') }),
				new THREE.MeshPhongMaterial({ map: bg_city_texture }),
				new THREE.MeshPhongMaterial({ map: bg_texture, emissiveMap: bg_texture, bumpMap: bg_texture, bumpScale: .25 }),
				new THREE.MeshPhongMaterial({ map: bg_texture_id, emissiveMap: bg_texture_id, emissive: new THREE.Color('gold'), bumpMap: bg_texture_id }),
				new THREE.MeshPhongMaterial({ map: bg_city_texture }),
			];
			var material = new THREE.MeshPhongMaterial({ color: 0x000000 });
			// var cpumaterial = new THREE.MeshPhongMaterial({ map: cputexture });

			mesh = new THREE.Mesh(geometry, materials);
			solarSystem.add(mesh);


			const earthOrbit = new THREE.Object3D();
			solarSystem.add(earthOrbit);


			cmesh = new THREE.LineSegments(new THREE.EdgesGeometry(
				new THREE.BoxBufferGeometry(200, 200, 200),
				15), new THREE.LineBasicMaterial({ color: 'gray' }));

			earthOrbit.add(cmesh);
			// earthOrbit.add(earthMesh);


			// spheremesh = new THREE.Mesh(sphere, cpumaterial);
			// spheremesh.translateX(-300)

			// add a light
			const color = 0xFFFFFF;
			const intensity = 1;
			const light = new THREE.DirectionalLight(color, intensity);
			light.position.set(-1, 2, 4);
			earthOrbit.add(light);


			renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(renderer.domElement);

			window.addEventListener('resize', onWindowResize, false);
		}
		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		}
		function animate() {
			bg_texture.needsUpdate = true;
			bg_texture_id.needsUpdate = true;
			bg_city_texture.needsUpdate = true;



			mesh.material[1].emissive = new THREE.Color(spin.color0);
			mesh.material[3].emissive = new THREE.Color(spin.color1);
			// mesh.material[5].emissive = new THREE.Color(spin.color2);
			mesh.material[0].emissive = new THREE.Color(spin.color3);
			// mesh.material[2].emissive = new THREE.Color(spin.color4);
			mesh.material[4].emissive = new THREE.Color(spin.color5);

			// materials[1].map.needsUpdate = true;
			// materials[1].needsUpdate = true;
			mesh.material[1].needsUpdate = true;
			mesh.material[3].needsUpdate = true;
			mesh.material[5].needsUpdate = true;
			requestAnimationFrame(animate);

			mesh.rotation.x += spin.rotx;
			mesh.rotation.y += spin.roty;
			cmesh.rotation.x += spin.rotx;
			cmesh.rotation.y += spin.roty;

			// console.log(spin.rotx)
			renderer.render(scene, camera);
		}

			// var scene = new THREE.Scene();
			// var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 1, 1000 );
			// camera.position.z = 400;

			// var renderer = new THREE.WebGLRenderer();
			// renderer.setSize( window.innerWidth, window.innerHeight );
			// document.body.appendChild( renderer.domElement );

			// // load a texture, set wrap mode to repeat
			// var texture = new THREE.TextureLoader().load("./stationid.png");
			// // texture.wrapS = THREE.RepeatWrapping;
			// // texture.wrapT = THREE.RepeatWrapping;
			// // texture.repeat.set(512, 512);


			// var geometry = new THREE.BoxBufferGeometry( 200, 200, 200 );
			// var material = new THREE.MeshBasicMaterial( { map: texture } );
			// var cube = new THREE.Mesh( geometry, material );
			// scene.add( cube );

			// camera.position.z = 5;

			// var animate = function () {
			// 	requestAnimationFrame( animate );

			// 	cube.rotation.x += 0.01;
			// 	cube.rotation.y += 0.01;

			// 	renderer.render( scene, camera );
			// };

			// animate();
	</script type="module">
	<div id="info"></div>
	<div id="info"></div>
</body>

</html>