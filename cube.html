<html>

<head>
	<title>My first three.js app</title>
	<style>
		body {
			margin: 0;
		}

		canvas {
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0);
		}

		#info {
			position: absolute;
			top: 10px;
			width: 100%;
			text-align: center;
			z-index: 100;
			display: block;
		}
	</style>
</head>

<body>
	<script type="module">
		import * as THREE from './js/three.module.js';
		import { GUI } from './js/dat.gui.module.js';

		var camera, scene, renderer, solarSystem;
		var mesh, cmesh;
		var bg_texture;
		var materials;

		
		let params = (new URL(document.location)).searchParams;
		let bg_color = params.get('color'); // is the string "Jonathan Smith".

		var SpinSpeed = function () {
			this.roty = Math.random() / 100;
			this.rotx = Math.random() / 100;
			this.color0 = "#ffae23";
			this.color1 = "#021984";
			this.color2 = "#179d7d";
			this.color3 = "#97cd34";
			this.color4 = "#b0c54f";
			this.color5 = "#e64659";
			this.displayOutline = false;
		};

		let rotx = Math.random() / 100
		let roty = Math.random() / 100
		const gui = new GUI();
		var spin = new SpinSpeed();
		gui.add(spin, 'roty', -.100, .100);
		gui.add(spin, 'rotx', -.100, .100);
		gui.addColor(spin, 'color0');
		gui.addColor(spin, 'color1');
		gui.addColor(spin, 'color2');
		gui.addColor(spin, 'color3');
		gui.addColor(spin, 'color4');
		gui.addColor(spin, 'color5');

		function cpu_texture() {
			const ctx = document.createElement('canvas').getContext('2d');
			// document.body.appendChild(ctx.canvas);
			ctx.canvas.width = 512;
			ctx.canvas.height = 512;
			// ctx.fillStyle = '#ffffff';
			//ffae23
			ctx.fillStyle = '#' + bg_color;
			ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
			var img = new Image();   // Create new img element
			img.addEventListener('load', function () {
				ctx.drawImage(img, 0, 0, 512, 512);
			}, false);
			img.src = 'cpu.png'; // Set source path
			// var bg_texture = 
			bg_texture = new THREE.CanvasTexture(ctx.canvas);
		}

		const ctx_id = document.createElement('canvas').getContext('2d');
		// document.body.appendChild(ctx.canvas);
		ctx_id.canvas.width = 512;
		ctx_id.canvas.height = 512;
		ctx_id.fillStyle = '#000000';
		ctx_id.fillRect(0, 0, ctx_id.canvas.width, ctx_id.canvas.height);
		var img_id = new Image();   // Create new img element
		img_id.addEventListener('load', function () {
			ctx_id.drawImage(img_id, 0, 0, 512, 512);
		}, false);
		img_id.src = 'stationid.png'; // Set source path

		const bg_texture_id = new THREE.CanvasTexture(ctx_id.canvas);

		init();
		animate();
		function init() {
			camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000);
			camera.position.z = 400;
			scene = new THREE.Scene();
			const loader = new THREE.TextureLoader();
			// var bg_texture;


			// var texture = new THREE.TextureLoader().load('stationid.png');
			// var cputexture = new THREE.TextureLoader().load('cpu.jpg');
			var geometry = new THREE.BoxBufferGeometry(200, 200, 200);
			var sphere = new THREE.SphereBufferGeometry(125, 32, 32);

			const solarSystem = new THREE.Object3D();
			scene.add(solarSystem);
			// var loader = new THREE.CubeTextureLoader();
			// loader.setPath('./');

			// var textureCube = loader.load([
			// 	'px.jpg', 'nx.jpg',
			// 	'py.jpg', 'ny.jpg',
			// 	'pz.jpg', 'nz.jpg'
			// ]);

			// var material = new THREE.MeshBasicMaterial({ color: 0xffffff, envMap: textureCube });

			cpu_texture();
			materials = [
				new THREE.MeshPhongMaterial({
					// map: loader.load('stationid.png'),
					map: bg_texture_id,
					emissiveMap: bg_texture_id, emissive: new THREE.Color('red'),
					bumpMap: bg_texture_id
				}),
				new THREE.MeshPhongMaterial({ map: bg_texture, emissiveMap: bg_texture, emissive: new THREE.Color('red') }),
				new THREE.MeshPhongMaterial({ map: bg_texture_id, emissiveMap: bg_texture_id, bumpMap: bg_texture_id }),
				new THREE.MeshPhongMaterial({ map: bg_texture,  emissiveMap: bg_texture, bumpMap: bg_texture, bumpScale: .25 }),
				new THREE.MeshPhongMaterial({ map: bg_texture_id, emissiveMap: bg_texture_id, emissive: new THREE.Color('gold'), bumpMap: bg_texture_id }),
				new THREE.MeshPhongMaterial({ map: bg_texture, emissiveMap: bg_texture, emissive: new THREE.Color('silver') }),
			];
			var material = new THREE.MeshPhongMaterial({ color: 0x000000 });
			// var cpumaterial = new THREE.MeshPhongMaterial({ map: cputexture });

			mesh = new THREE.Mesh(geometry, materials);
			solarSystem.add(mesh);


			const earthOrbit = new THREE.Object3D();
			solarSystem.add(earthOrbit);


			cmesh = new THREE.LineSegments(new THREE.EdgesGeometry(
				new THREE.BoxBufferGeometry(200, 200, 200),
				15), new THREE.LineBasicMaterial({ color: 'gray' }));

			earthOrbit.add(cmesh);
			// earthOrbit.add(earthMesh);


			// spheremesh = new THREE.Mesh(sphere, cpumaterial);
			// spheremesh.translateX(-300)

			// add a light
			const color = 0xFFFFFF;
			const intensity = 1;
			const light = new THREE.DirectionalLight(color, intensity);
			light.position.set(-1, 2, 4);
			earthOrbit.add(light);


			renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(renderer.domElement);

			window.addEventListener('resize', onWindowResize, false);
		}
		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		}
		function animate() {
			bg_texture.needsUpdate = true;
			bg_texture_id.needsUpdate = true;
	

			mesh.material[1].emissive = new THREE.Color(spin.color0);
			mesh.material[3].emissive = new THREE.Color(spin.color1);
			mesh.material[5].emissive = new THREE.Color(spin.color2);
			mesh.material[0].emissive = new THREE.Color(spin.color3);
			mesh.material[2].emissive = new THREE.Color(spin.color4);
			mesh.material[4].emissive = new THREE.Color(spin.color5);
			
			// materials[1].map.needsUpdate = true;
			// materials[1].needsUpdate = true;
			mesh.material[1].needsUpdate = true;
			mesh.material[3].needsUpdate = true;
			mesh.material[5].needsUpdate = true;
			requestAnimationFrame(animate);

			mesh.rotation.x += spin.rotx;
			mesh.rotation.y += spin.roty;
			cmesh.rotation.x += spin.rotx;
			cmesh.rotation.y += spin.roty;

			// console.log(spin.rotx)
			renderer.render(scene, camera);
		}

			// var scene = new THREE.Scene();
			// var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 1, 1000 );
			// camera.position.z = 400;

			// var renderer = new THREE.WebGLRenderer();
			// renderer.setSize( window.innerWidth, window.innerHeight );
			// document.body.appendChild( renderer.domElement );

			// // load a texture, set wrap mode to repeat
			// var texture = new THREE.TextureLoader().load("./stationid.png");
			// // texture.wrapS = THREE.RepeatWrapping;
			// // texture.wrapT = THREE.RepeatWrapping;
			// // texture.repeat.set(512, 512);


			// var geometry = new THREE.BoxBufferGeometry( 200, 200, 200 );
			// var material = new THREE.MeshBasicMaterial( { map: texture } );
			// var cube = new THREE.Mesh( geometry, material );
			// scene.add( cube );

			// camera.position.z = 5;

			// var animate = function () {
			// 	requestAnimationFrame( animate );

			// 	cube.rotation.x += 0.01;
			// 	cube.rotation.y += 0.01;

			// 	renderer.render( scene, camera );
			// };

			// animate();
	</script type="module">
	<div id="info"></div>
</body>

</html>